# Open Collective Discord Bot Specifications

This bot is installed at the server level.

## Commands

### /setup-token

Only available to admins

This command lets the user configure the bot for their server.

It first asks to either create a token to reward contributions or to use an existing one, in which case it asks for the chain and token address and fetches the token name, symbol and decimals using viem and a default RPC url based on the chain used.

If the user wants to create a new token, it is then creating a modal to enter the details for that token: 
- Name (default to `${guildName} Token`)
- Symbol (default to `${guildName.split(" ").map(w => w.substring(0,1)).toUpperCase()}T`)

Then it deploys a default ERC20 token on base_sepolia using Deno.env.get("PRIVATE_KEY").

The bot then proceeds to create a folder in `/data/[guildId]/settings.json` to record the channelId for each of those channels.

```ts
type BlockchainAddress = `0x${string}`;

type Settings = {
  contributionToken: {
    name: string;
    symbol: string;
    decimals: number;
    chain: "celo" | "gnosis" | "base" | "base_sepolia" | "polygon";
    address: BlockchainAddress;
  }
  guild: {
    id: string,
    name: string,
    icon: string
  }
  creator: {
    id: string,
    username: string,
    globalName: string,
    avatar: string
  }
  channels {
    transactions: string,
    contributions: string,
    logs: string
  }
}
```

### /setup-channels

Only for admins

Asks the user for the main channels that should be used by the bot:
- #transactions: where transactions are logged
- #contributions: where members share their contributions
- #logs: for system logs

Autosave. No need to show the result since people can see in the dropdown the channel selected.

### /edit-rewards

Only available to admins

Let the user define to amount of tokens per day/week/month to issue to the members of a given role, with the option to notify some roles when the given role doesn't have any member at the moment and the option to only issue or burn tokens to members that have posted a contribution in the #contributions channel since last issuance.

The bot then records that reward in `/data/[guildId]/roles.json` (if a reward/cost for the same roleId exists, it overwrites it).

```ts
type RoleSetting = {
  roleId: string;
  amountToMint: number;
  amountToBurn: number;
  frequency: "daily" | "weekly" | "monthly";
  rolesToPingIfEmpty: string[];
  onlyToActiveContributors: boolean;
}

type roles = RoleSetting[];
```
 
### /edit-costs

Only available to admins

Let the user define the amount of tokens per day/week/month to burn from the members of a given role.

The bot then records that cost in `/data/[guildId]/roles.json` (if a reward/or cost for the same roleId exists, it overwrites it).

